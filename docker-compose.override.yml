services:
  application:
    env_file:
      - ./.env.example.local-serve
    depends_on:
      - application-database
    volumes:
      - .:/var/www
      - ./storage:/var/www/storage
      - ./docker/scripts/wait-for-it.sh:/usr/local/bin/wait-for-it.sh
    command: >
      sh -c "/usr/local/bin/wait-for-it.sh application-database:3306 --timeout=30 --strict -- php artisan serve --host=0.0.0.0 --port=8000 & php artisan queue:work --sleep=3 --tries=3"

  application-database:
    container_name: mysql
    image: mysql:8.0
    restart: unless-stopped
    env_file:
      - ./.env.example.local-serve
    volumes:
      - db_data:/var/lib/mysql
    networks:
      - app-network

  application-mailhog:
    image: mailhog/mailhog:latest
    container_name: mailhog
    ports:
      - "8025:8025"
    networks:
      - app-network

  application-storage:
    container_name: minio
    image: minio/minio:latest
    restart: unless-stopped
    env_file:
      - ./.env.example.local-serve
    command: server /data --console-address ":9001"
    ports:
      - "9000:9000"  # API
      - "9001:9001"  # Console
    volumes:
      - minio_data:/data
    networks:
      - app-network
